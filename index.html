

	<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C++ Thread Memory Leak Analyzer - POC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 30px 0;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .demo-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .code-editor {
            display: flex;
            gap: 20px;
            height: 500px;
        }

        .editor-panel {
            flex: 1;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .editor-header {
            background: #f5f5f5;
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            font-weight: bold;
            color: #555;
        }

        textarea {
            width: 100%;
            height: calc(100% - 60px);
            border: none;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: none;
            outline: none;
            background: #fafafa;
        }

        .results-panel {
            height: 100%;
            overflow-y: auto;
            padding: 15px;
            background: #fafafa;
        }

        .analyze-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 25px;
            cursor: pointer;
            margin: 20px auto;
            display: block;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .issue {
            background: white;
            border-left: 5px solid;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .issue.critical { border-left-color: #e74c3c; }
        .issue.high { border-left-color: #f39c12; }
        .issue.medium { border-left-color: #f1c40f; }
        .issue.low { border-left-color: #3498db; }

        .issue-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 10px;
        }

        .severity-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }

        .severity-badge.critical { background: #e74c3c; }
        .severity-badge.high { background: #f39c12; }
        .severity-badge.medium { background: #f1c40f; color: #333; }
        .severity-badge.low { background: #3498db; }

        .code-snippet {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .feature-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .no-issues {
            text-align: center;
            color: #27ae60;
            font-size: 18px;
            font-weight: bold;
            padding: 30px;
        }

        .sample-issues {
            margin-top: 20px;
        }

        .tab-container {
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-radius: 10px;
            padding: 5px;
        }

        .tab {
            flex: 1;
            padding: 10px 20px;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .tab.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç C++ Thread Memory Leak Analyzer</h1>
            <p>AI-Powered Code Review for Share Market Applications</p>
        </div>

        <!-- Features Overview -->
        <div class="demo-section">
            <h2>üöÄ Key Features</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">üßµ</div>
                    <h3>Thread Lifecycle Analysis</h3>
                    <p>Detects unjoined threads, improper cleanup, and resource leaks in multi-threaded applications</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üìà</div>
                    <h3>Market-Specific Patterns</h3>
                    <p>Specialized detection for trading apps: OrderBook, MarketData, WebSocket threads</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">‚ö°</div>
                    <h3>Real-time Analysis</h3>
                    <p>Instant feedback with severity-based reporting and actionable suggestions</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üõ°Ô∏è</div>
                    <h3>RAII Compliance</h3>
                    <p>Ensures proper resource management and modern C++ best practices</p>
                </div>
            </div>
        </div>

        <!-- Interactive Demo -->
        <div class="demo-section">
            <div class="tab-container">
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('demo')">Interactive Demo</div>
                    <div class="tab" onclick="switchTab('samples')">Sample Issues</div>
                </div>
            </div>

            <div id="demo-content" class="tab-content active">
                <h2>üñ•Ô∏è Try the Analyzer</h2>
                <p style="margin-bottom: 20px;">Paste your C++ code in the editor below and click "Analyze Code" to see the magic happen!</p>
                
                <div class="code-editor">
                    <div class="editor-panel">
                        <div class="editor-header">üìù C++ Code Editor</div>
                        <textarea id="codeInput" placeholder="Paste your C++ code here...">class MarketDataThread {
    std::thread* worker_thread;
    std::mutex* data_mutex;
    
public:
    MarketDataThread() {
        data_mutex = new std::mutex();
        worker_thread = new std::thread(&MarketDataThread::process_data, this);
    }
    // Missing destructor - MEMORY LEAK!
    
    void process_data() {
        while (true) {
            Order* order = new Order(); // Potential leak
            data_mutex->lock();
            process_market_data(order);
            // Missing unlock() and delete order!
        }
    }
};

void start_trading_system() {
    std::thread price_thread(update_prices); // Never joined!
    
    MarketDataThread* mdt = new MarketDataThread(); // Never deleted!
    
    pthread_t order_thread;
    pthread_create(&order_thread, NULL, process_orders, NULL); // Never joined
    
    WebSocketClient* ws = new WebSocketClient();
    ws->start_streaming(); // Creates internal threads without cleanup
}</textarea>
                    </div>
                    
                    <div class="editor-panel">
                        <div class="editor-header">üìä Analysis Results</div>
                        <div class="results-panel" id="results">
                            <div style="text-align: center; color: #666; padding: 50px;">
                                Click "Analyze Code" to see results here
                            </div>
                        </div>
                    </div>
                </div>
                
                <button class="analyze-btn" onclick="analyzeCode()">üîç Analyze Code</button>
            </div>

            <div id="samples-content" class="tab-content">
                <h2>üìö Common Issues in Share Market Applications</h2>
                <div class="sample-issues" id="sampleIssues">
                    <!-- Sample issues will be populated here -->
                </div>
            </div>
        </div>

        <!-- ROI Calculator -->
        <div class="demo-section">
            <h2>üí∞ ROI Calculator</h2>
            <p>Calculate potential savings from implementing automated code review:</p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
                <div>
                    <label>Developers on team:</label>
                    <input type="number" id="devCount" value="10" style="width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                <div>
                    <label>Average hourly rate ($):</label>
                    <input type="number" id="hourlyRate" value="75" style="width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                <div>
                    <label>Hours spent debugging/week:</label>
                    <input type="number" id="debugHours" value="8" style="width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px;">
                </div>
            </div>
            
            <button onclick="calculateROI()" style="background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Calculate Savings</button>
            
            <div id="roiResults" style="margin-top: 20px;"></div>
        </div>
    </div>

    <script>
        // Mock analyzer for demo purposes
        function analyzeCode() {
            const code = document.getElementById('codeInput').value;
            const resultsDiv = document.getElementById('results');
            
            // Show loading
            resultsDiv.innerHTML = '<div style="text-align: center; padding: 50px;">üîÑ Analyzing code...</div>';
            
            setTimeout(() => {
                const issues = mockAnalyze(code);
                displayResults(issues);
            }, 1500);
        }

        function mockAnalyze(code) {
            const issues = [];
            
            // Simulate detection logic
            if (code.includes('new std::thread') && !code.includes('delete')) {
                issues.push({
                    line: 8,
                    severity: 'critical',
                    type: 'Thread Memory Management',
                    description: 'Thread allocated on heap without corresponding delete',
                    code: 'worker_thread = new std::thread(...)',
                    suggestion: 'Use std::unique_ptr<std::thread> or ensure proper delete in destructor'
                });
            }
            
            if (code.includes('std::thread') && !code.includes('.join()') && !code.includes('.detach()')) {
                issues.push({
                    line: 22,
                    severity: 'critical',
                    type: 'Thread Lifecycle',
                    description: 'Thread created but never joined or detached',
                    code: 'std::thread price_thread(update_prices);',
                    suggestion: 'Add .join() before thread goes out of scope or use .detach()'
                });
            }
            
            if (code.includes('new std::mutex') && !code.includes('delete')) {
                issues.push({
                    line: 6,
                    severity: 'high',
                    type: 'Mutex Management',
                    description: 'Mutex allocated on heap without delete',
                    code: 'data_mutex = new std::mutex();',
                    suggestion: 'Use stack allocation or smart pointers for mutex objects'
                });
            }
            
            if (code.includes('.lock()') && !code.includes('.unlock()')) {
                issues.push({
                    line: 14,
                    severity: 'high',
                    type: 'Lock Management',
                    description: 'Manual lock() without corresponding unlock()',
                    code: 'data_mutex->lock();',
                    suggestion: 'Use RAII with std::lock_guard or std::unique_lock'
                });
            }
            
            if (code.includes('pthread_create') && !code.includes('pthread_join')) {
                issues.push({
                    line: 26,
                    severity: 'high',
                    type: 'pthread Management',
                    description: 'pthread_create without pthread_join - resource leak',
                    code: 'pthread_create(&order_thread, NULL, process_orders, NULL);',
                    suggestion: 'Add pthread_join() or pthread_detach() call'
                });
            }
            
            if (code.includes('MarketDataThread') && !code.includes('~MarketDataThread')) {
                issues.push({
                    line: 1,
                    severity: 'high',
                    type: 'Thread Class Design',
                    description: 'MarketDataThread class has no destructor for cleanup',
                    code: 'class MarketDataThread {',
                    suggestion: 'Add destructor to properly clean up threads and resources'
                });
            }
            
            return issues;
        }

        function displayResults(issues) {
            const resultsDiv = document.getElementById('results');
            
            if (issues.length === 0) {
                resultsDiv.innerHTML = '<div class="no-issues">‚úÖ No thread memory leak issues detected!</div>';
                return;
            }
            
            let html = '<div class="stats-panel">';
            const critical = issues.filter(i => i.severity === 'critical').length;
            const high = issues.filter(i => i.severity === 'high').length;
            const medium = issues.filter(i => i.severity === 'medium').length;
            const low = issues.filter(i => i.severity === 'low').length;
            
            html += `
                <div class="stat-card"><div class="stat-number">${issues.length}</div>Total Issues</div>
                <div class="stat-card"><div class="stat-number">${critical}</div>Critical</div>
                <div class="stat-card"><div class="stat-number">${high}</div>High</div>
                <div class="stat-card"><div class="stat-number">${medium}</div>Medium</div>
            `;
            html += '</div>';
            
            issues.forEach(issue => {
                html += `
                    <div class="issue ${issue.severity}">
                        <div class="issue-header">
                            <div>
                                <strong>Line ${issue.line}: ${issue.type}</strong>
                                <span class="severity-badge ${issue.severity}">${issue.severity.toUpperCase()}</span>
                            </div>
                        </div>
                        <p><strong>Issue:</strong> ${issue.description}</p>
                        <div class="code-snippet">${issue.code}</div>
                        <p><strong>üí° Suggestion:</strong> ${issue.suggestion}</p>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }

        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update content
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(tab + '-content').classList.add('active');
            
            if (tab === 'samples') {
                loadSampleIssues();
            }
        }

        function loadSampleIssues() {
            const sampleIssues = [
                {
                    line: 15,
                    severity: 'critical',
                    type: 'OrderBook Thread Leak',
                    description: 'OrderBook update thread created in tight loop without cleanup',
                    code: 'while(market_open) { new std::thread(update_orderbook); }',
                    suggestion: 'Use thread pool or reuse existing threads for high-frequency updates'
                },
                {
                    line: 42,
                    severity: 'high',
                    type: 'WebSocket Connection',
                    description: 'WebSocket streaming thread not properly managed',
                    code: 'ws_thread = new std::thread(stream_prices);',
                    suggestion: 'Implement proper connection lifecycle with RAII pattern'
                },
                {
                    line: 78,
                    severity: 'medium',
                    type: 'Risk Management',
                    description: 'Risk calculation thread using manual memory management',
                    code: 'RiskData* data = new RiskData(); // in thread loop',
                    suggestion: 'Use stack allocation or object pools for frequent allocations'
                }
            ];
            
            let html = '';
            sampleIssues.forEach(issue => {
                html += `
                    <div class="issue ${issue.severity}">
                        <div class="issue-header">
                            <div>
                                <strong>Line ${issue.line}: ${issue.type}</strong>
                                <span class="severity-badge ${issue.severity}">${issue.severity.toUpperCase()}</span>
                            </div>
                        </div>
                        <p><strong>Issue:</strong> ${issue.description}</p>
                        <div class="code-snippet">${issue.code}</div>
                        <p><strong>üí° Suggestion:</strong> ${issue.suggestion}</p>
                    </div>
                `;
            });
            
            document.getElementById('sampleIssues').innerHTML = html;
        }

        function calculateROI() {
            const devCount = parseInt(document.getElementById('devCount').value);
            const hourlyRate = parseInt(document.getElementById('hourlyRate').value);
            const debugHours = parseInt(document.getElementById('debugHours').value);
            
            const weeklyDebugCost = devCount * hourlyRate * debugHours;
            const yearlyDebugCost = weeklyDebugCost * 52;
            const potentialSavings = yearlyDebugCost * 0.4; // Assume 40% reduction in debug time
            
            const toolCost = 50000; // Estimated annual tool cost
            const netSavings = potentialSavings - toolCost;
            const roi = ((netSavings / toolCost) * 100).toFixed(1);
            
            document.getElementById('roiResults').innerHTML = `
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 5px solid #28a745;">
                    <h3>üíº ROI Analysis</h3>
                    <p><strong>Current annual debugging cost:</strong> $${yearlyDebugCost.toLocaleString()}</p>
                    <p><strong>Potential annual savings:</strong> $${potentialSavings.toLocaleString()}</p>
                    <p><strong>Estimated tool cost:</strong> $${toolCost.toLocaleString()}</p>
                    <p><strong>Net savings:</strong> $${netSavings.toLocaleString()}</p>
                    <p style="font-size: 1.2em; color: #28a745;"><strong>ROI: ${roi}%</strong></p>
                    <small>*Based on 40% reduction in debugging time through early detection</small>
                </div>
            `;
        }

        // Initialize with sample analysis
        window.onload = function() {
            setTimeout(analyzeCode, 1000);
        };
    </script>
</body>
</html>
